title: 从 webpack 1 到 webpack 2 的迁移记
date: 2017-02-14 08:42:00
categories: 技术研究
tags: [javascript,前端,webpack]
---
[kk-player 429482207]
[00:16.09]Tryin' to get control
[00:17.68]Pressure's takin' its toll
[00:19.61]Stuck in the middle zone
[00:21.59]I just want you alone
[00:23.49]My guessing game is strong
[00:25.31]Way too real to be wrong
[00:27.30]Caught up in your show
[00:28.77]Yeah, at least now I know
[00:30.27]
[00:30.58]It wasn't love, it wasn't love
[00:34.26]It was a perfect illusion (Perfect illusion)
[00:37.97]Mistaken for love, it wasn't love
[00:41.88]It was a perfect illusion (Perfect illusion)
[00:48.06]You were a perfect illusion
[00:50.65]
[00:50.78]I don't need eyes to see
[00:52.22]I felt you touchin' me
[00:54.40]High like amphetamine
[00:56.24]Maybe you're just a dream
[00:58.01]That's what it means to crush
[01:00.08]Now that I'm wakin' up
[01:01.85]I still feel the blow
[01:03.39]But at least now I know
[01:04.70]
[01:04.93]It wasn't love, it wasn't love
[01:08.81]It was a perfect illusion (Perfect illusion)
[01:12.52]Mistaken for love, it wasn't love
[01:16.49]It was a perfect illusion (Perfect illusion)
[01:21.09]
[01:21.24]Where are you?
[01:22.05]Cause I can't see you
[01:22.92]It was a perfect illusion
[01:23.43]But I feel you watchin' me
[01:24.90]Dilated, falling free
[01:26.76]In a modern ecstasy
[01:28.71]Where are you?
[01:29.52]Cause I can't see you
[01:30.49]It was a perfect illusion
[01:31.33]But I feel you watchin' me
[01:32.74]But I feel you watchin' me
[01:34.59]Illusion
[01:35.28]But I feel you watchin' me
[01:36.04]Mistaken for love
[01:40.97]Dilated, falling free
[01:43.03]In a modern ecstasy
[01:43.89]Mistaken for love
[01:45.75]In a modern ecstasy
[01:46.13]In a modern ecstasy
[01:47.76]
[01:48.29]I'm over the show
[01:49.39]Yeah, at least now I know
[01:50.92]
[01:51.22]It wasn't love, it wasn't love
[01:54.83]It was a perfect illusion (Perfect illusion)
[01:58.74]Mistaken for love, it wasn't love
[02:02.67]It was a perfect illusion(Perfect illusion)
[02:12.57]You were a perfect illusion
[02:20.26]It was a perfect illusion
[02:24.65]
[02:24.86]It was a perfect illusion
[02:27.93]Somewhere in all the confusion
[02:31.52]It was a perfect illusion, illusion, illusion
[02:40.25]It was a perfect illusion
[02:43.13]Somewhere in all the confusion
[02:47.07]You were so perfect
[02:50.08]You were a, you were a perfect illusion
[/kk-player]<br />
最近上手新项目的时候想要用个 sass，结果发现 npm 里面的 sass-loader 默认的 peerDependencies 中的 webpack 版本被升级到了 2<br />
当时没想太多，就装了个 webpack 2.2.1来用，结果发现以前项目的 webpack 配置居然不能够直接用！一跑起来一还堆错<br />
上网查了下，才知道 webpack 2 弄了很多 breaking changes ，想着反正这些问题迟早要解决的，于是就开始了我的 webpack 2 踩坑过程<br />
<!--more--> <br />
<span style="font-size:18px;">1、以前那种省略 '-loader' 的写法不能直接用了</span><br />
具体信息参考<a href="https://github.com/webpack/webpack/releases/tag/v2.1.0-beta.26" target="_blank">https://github.com/webpack/webpack/releases/tag/v2.1.0-beta.26</a><br />
如果还是要用以前的这种省略式的写法，需要在webpack的配置文件中添加一条配置项<br />
<pre class="brush:js; toolbar:false;">resolveLoader: {moduleExtensions : ['-loader']}</pre>
<span style="font-size:18px;">2、相关插件都要对应的进行升级</span><br />
webpack 2和旧版本的extract-text-webpack-plugin似乎不兼容<br />
如果要extract-text-webpack-plugin，则extract-text-webpack-plugin的版本也要升到 2.0 以上<br />
截至写这篇文章为止，extract-text-webpack-plugin的最新版本是2.0.0-rc.3，可以直接复制下面的命令安装<br />
<pre class="brush:js; toolbar:false;">npm install extract-text-webpack-plugin@2.0.0-rc.3 --save-dev
</pre>
<br />
注：如果安装了旧版本的extract-text-webpack-plugin，需要先卸载旧版，再安装新版<br />
<span style="font-size:14px;">webpack-dev-server也是一样，需要安装2.0或更高版本：</span><br />
<pre class="brush:js; toolbar:false;">npm install webpack-dev-server@latest --save-dev</pre>
<br />
<span style="font-size:18px;">3、extract-text-webpack-plugin 中 extract 方法的参数需要修改</span><br />
比如之前需要合成sass的话，直接这样配置就可以了<br />
<pre class="brush:js; toolbar:false;">test: /\.scss/,
loader: ExtractTextPlugin.extract('style-loader', 'css-loader','sass-loader')</pre>
<br />
当时的参数形式是这样的：<br />
<pre class="brush:js; toolbar:false;">ExtractTextPlugin.extract([notExtractLoader], loader, [options])</pre>
接着换成新的参数形式是这样的：<br />
<pre class="brush:js; toolbar:false;">ExtractTextPlugin.extract({[fallback], use, [publicPath]})</pre>
其中参数形式变成了对象，不再是原来那样直接传字符串，接着notExtractLoader改了个名字叫fallback（之前还叫过fallbackLoader），loader改名成了use<br />
所以上面那个例子转换过来之后的形式是这个样子的：<br />
<pre class="brush:js; toolbar:false;">test: /\.scss/,
loader: ExtractTextPlugin.extract({
      fallback: "style-loader",
      use: ["css-loader", "sass-loader"]
})</pre>
<br />
还好我这边的配置不是很多，所以改动量就只有这么大<br />
不过理解起来还是稍微废了点劲，写出来之后就明白多了<br />
<br />
<span style="font-size:24px;">参考资料：</span><br />
<blockquote>
	<a href="https://github.com/webpack-contrib/extract-text-webpack-plugin/blob/webpack-1/README.md" target="_blank">Webpack 1 ReadMe<br />
</a><a href="https://github.com/webpack-contrib/extract-text-webpack-plugin/blob/master/README.md" target="_blank">Webpack 2 ReadMe<br />
</a><a href="https://webpack.js.org/guides/migrating/" target="_blank">Migrating from v1 to v2<br />
</a><a href="http://javascriptplayground.com/blog/2016/10/moving-to-webpack-2/" target="_blank">Migrating to Webpack 2</a> 
</blockquote>
<br />