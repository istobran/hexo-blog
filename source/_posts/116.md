title: PyQt4——自制带提示的滑动槽
date: 2015-12-13 07:35:00
categories: 项目开发
tags: [PYTHON]
---
<p>
	<span style="line-height:1.5;">在写那个引擎配置器的过程中，发现PyQt4的滑动槽并没有那么好用</span> 
</p>
<p>
	对比下Windows的滑动槽，我们可以很容易的发现一个问题
</p>
<p>
	比如调节音量的音量柄，我们在拖动的时候，它会在旁边伴随着一个气泡提示
</p>
<p>
	<img src="//bangz.me/usr/uploads/image/20151213/20151213153353_21207.png" alt="" /> 
</p>
<p>
	可是我们在PyQt4的滑动柄上并没有发现这个功能，拖着完全就是瞎拖，完全没有一个量的概念
</p>
<p>
	<!--more-->
</p>
<p>
	<br />
</p>
<p>
	<br />
</p>
<p>
	<br />
</p>
<p>
	<!--more-->
</p>
<p>
	通过谷歌搜索了国内外的各大论坛，好像都没有一个解决方案，自己弄弄了半天也弄不出来
</p>
<p>
	于是上StackOverflow发了个贴问了问：
</p>
<p>
	<a href="http://stackoverflow.com/questions/31653647/how-to-make-a-tip-to-follow-the-handler-of-slider-with-pyqt" target="_blank">http://stackoverflow.com/questions/31653647/how-to-make-a-tip-to-follow-the-handler-of-slider-with-pyqt</a> 
</p>
<p>
	还真的是有大牛出来帮解决了，好评！国外的学术气氛就是不一样。
</p>
<p>
	好了，下面说一下总体的方法。
</p>
<p>
	一开始，我只是参考了一下网上的一些解决方案，弄来弄去，发现顶多只能做到气泡跟随鼠标来移动
</p>
<p>
	也就是这个做法
</p>
<pre class="brush:python; toolbar:false;">QtGui.QToolTip.showText(QtGui.QCursor.pos(), str(value), self)</pre>
接着就完全不知道怎么做了，顶多只能获取到鼠标指针的坐标，无法获取到滑动柄的下标
<p>
	<br />
</p>
<p>
	查遍了PyQt官方文档的方法，还是没有结果
</p>
<p>
	看了StackOverflow人家给的回答之后，才知道，这个必须把QSlider的封装给拆开才能弄
</p>
<p>
	拆开封装获取到里面的长方形滑块
</p>
<pre class="brush:python; toolbar:false;">style=self.slider.style()
opt=QtGui.QStyleOptionSlider()
self.slider.initStyleOption(opt)
rectHandle=style.subControlRect(QtGui.QStyle.CC_Slider,opt, QtGui.QStyle.SC_SliderHandle,self)</pre>
这个长方形滑块是属于QRect类的一个对象
<p>
	<br />
</p>
<p>
	可以通过以下方法获取到这个滑块的右下角位置的绝对坐标
</p>
<pre class="brush:python; toolbar:false;">myPoint=rectHandle.bottomRight()+self.slider.pos()</pre>
也可以分别获取其中的x,y坐标，这个牛人还总结出了一个magic number。。。这个其实可以看成是个固定偏移吧
<pre class="brush:python; toolbar:false;">magicX=5
magicY=15

x=rectHandle.right()+rectHandle.width()+self.slider.pos().x()+magicX
y=rectHandle.bottom()+rectHandle.height()+self.slider.pos().y()+magicY</pre>
最后，再把获得的x,&nbsp;y坐标给重新构成个QPoint，并根据这个坐标把气泡显示出来
<pre class="brush:python; toolbar:false;">QtGui.QToolTip.showText(QtCore.QPoint(x,y), str(value), self)</pre>
<p>
	<br />
</p>
<p>
	<br />
</p>