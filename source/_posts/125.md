title: javascript编写正方系统评教脚本
date: 2016-01-02 16:19:00
categories: 技术研究
tags: [HTML5,CSS3,javascript]
---
[KK-Player 26390073]<br />
[00:15.530]La la, la la la...<br />
[00:30.620]Hush, don’t speak<br />
[00:33.470]When you spit your venom, keep it shut I hate it<br />
[00:38.020]When you hiss and preach<br />
[00:41.420]About your new messiah ’cause your theories catch fire<br />
[00:46.070]I can’t find those silver linings<br />
[00:49.720]I don’t mean to judge<br />
[00:53.270]But when you read your speech, it’s tiring<br />
[00:57.570]Enough is enough<br />
[01:01.580]I’m covering my ears like a kid<br />
[01:04.830]When your words mean nothing, I go la la la<br />
[01:09.180]I’m turning off the volume when you speak<br />
[01:12.680]Cause if my heart can’t stop it, I find a way to block it<br />
[01:17.130]I go<br />
[01:17.730]La la, la la la...<br />
[01:20.340]La la, la la la...<br />
[01:23.990]I find a way to block it<br />
[01:25.390]I go<br />
[01:25.840]La la, la la la...<br />
[01:27.290]La la, la la la...<br />
[01:32.890]Yes our love is running out of time<br />
[01:37.180]I won’t count the hours, rather be a coward<br />
[01:40.530]When our words collide<br />
[01:44.320]I’m gonna drown you out before I lose my mind<br />
[01:49.220]I can’t find those silver linings<br />
[01:52.220]I don’t mean to judge<br />
[01:55.920]But when you read your speech, it’s tiring<br />
[02:00.020]Enough is enough<br />
[02:04.420]I’m covering my ears like a kid<br />
[02:07.620]When your words mean nothing, I go la la la<br />
[02:12.070]I’m turning off the volume when you speak<br />
[02:15.470]Cause if my heart can’t stop it, I find a way to block it<br />
[02:19.520]I go<br />
[02:20.020]La la la la la...<br />
[02:23.020]La la la la la...<br />
[02:25.270]I find a way to block it<br />
[02:26.870]I go<br />
[02:27.770]La la la la la...<br />
[02:29.670]La la la la la...<br />
[02:33.220]I find a way to block you, oh<br />
[02:38.530]La la la la la...<br />
[02:39.780]La la la la la...<br />
[02:41.380]I find a way to block it<br />
[02:42.930]I go<br />
[02:43.380]La la la la la...<br />
[02:45.180]La la la la la...<br />
[02:51.880]I’m covering my ears like a kid<br />
[02:54.380]When your words mean nothing, I go la la la<br />
[02:59.030]I’m turning off the volume when you speak<br />
[03:02.530]Cause if my heart can’t stop it, I find a way to block it<br />
[03:06.930]I go<br />
[03:07.730]I’m covering my ears like a kid<br />
[03:10.380]When your words mean nothing, I go la la la<br />
[03:14.280]I’m turning off the volume when you speak<br />
[03:17.780]Cause if my heart can’t stop it, I find a way to block it<br />
[03:22.090]I go<br />
[03:22.890]La la la la la...<br />
[03:24.590]La la la la la...<br />
[03:27.190]La la la la la...<br />
[03:38.370]<br />
[/KK-Player]
<p>
	<span style="line-height:1.5;">之前学校又搞起了评教，觉得每次评教都要鼠标点老半天</span> 
</p>
<p>
	实在是不爽，于是想着自己写个快速评教脚本，顺便练习一下久违的javascript
</p>
<p>
	于是动手，用chrome在线调试功能来写
</p>
<p>
	之前只是稍微见过别人调试，<span style="line-height:1.5;">没有自己深究过这玩意</span> 
</p>
<p>
	<span style="line-height:1.5;">现在发现chrome的console还真是挺强大的一个工具</span> 
</p>
<p>
	<span style="line-height:1.5;">直接按F12，然后切换到console选项卡就可以呼出控制台</span> 
</p>
<p>
	<span style="line-height:1.5;"><img src="/usr/uploads/image/20160103/20160103003008_75620.png" alt="" /><br />
</span> 
</p>
<p>
	<span style="line-height:1.5;">于是下意识来个“hello world”，哈哈</span> 
</p>
<!--more-->
<p>
	<br />
</p>
<p>
	<br />
</p>
<p>
	<span style="line-height:1.5;">这个控制台其实就是一个调试javascript的控制台</span> 
</p>
<p>
	<span style="line-height:1.5;">可以用它来交互式的编写js脚本，输入一句就执行一句</span> 
</p>
<p>
	直接在上面输入alert("xxx")，然后回车。接着就会像之前编写js一样弹出xxx警告消息
</p>
<p>
	上面用到的console对象是chrome独有的一个对象。
</p>
<p>
	咱常用到他的log方法来实现在控制台记录日志，就像其他语言中的print函数一样的
</p>
<p>
	chrome的控制台就说到这里，接下进入正题。
</p>
<p>
	<br />
</p>
<p>
	在进入正方教务系统后，我想像之前一样用dom内置对象直接获取页面中的下拉菜单
</p>
<p>
	但却弄半天发现获取不到，于是我就奇了怪了，开始怀疑是不是有什么代码能够干扰DOM操作
</p>
<p>
	经过反复的测试，终于发现，原来那个表单是在iframe内的，从iframe那里开始就无法进一步获取到iframe内的对象了
</p>
<p>
	用Google查了查，才知道，原来iframe内的元素相当于重新多了一层DOM模型，用我的理解图来解释的话是这样的
</p>
<p>
	<img src="/usr/uploads/image/20160112/20160112150330_78901.png" alt="" /> 
</p>
<p>
	所以，要获取iframe内的元素的话，必须先获取iframe，具体代码如下
</p>
<pre class="brush:js; toolbar:false;">var iframe = document.getElementById('iframeautoheight');
var innerDoc = iframe.contentDocument || iframe.contentWindow.document;</pre>
接着就可以进行DOM操作了
<pre class="brush:js; toolbar:false;">var selects = innerDoc.getElementsByTagName('select');</pre>
接着只需要再筛选出ID中包含"DataGrid__"打头的元素，就能获取到所有的评分下拉列表了
<pre class="brush:js; toolbar:false;">var scorelist = [];

// 找到下拉菜单列表
for (var i = 0; i &lt; selects.length; i++) {
    if (selects[i].id.indexOf("DataGrid1__") &gt; -1) {
        scorelist.push(selects[i]);
    }
}</pre>
最后，由于评教不能够所有的评分都是一致的，要选出其中一个来改一改，于是用上random函数随机产生一个值
<pre class="brush:js; toolbar:false;">var rid = Math.floor(Math.random()*scorelist.length);</pre>
把这个值设成对应的分数即可
<pre class="brush:js; toolbar:false;">if (i == rid) {
      if (tempValue == '4(良好)') {
            ops[j].selected = true;
      }
}</pre>
其实也可以参考<a href="https://ikk.me/archives/default/javascript_autocomplete_jwxt.html" target="_blank">KK的做法</a>，直接设置select元素的value值。提交的时候的数据都是一样的（佩服KK，揣摩的太透彻）
<p>
	<br />
</p>
<p>
	<br />
</p>
<p>
	程序源码已提交至<a href="https://github.com/istobran/ZFRateTeacher" target="_blank">GitHub</a> 
</p>